# 2022-12

## 2022-12-01

https://github.com/ruanyl/vim-gh-line

よく使っているため内部を知っておきたいと思ったことと、サイズが小さそうなので気軽に読めそうだと思ったので読んでみた。

- `system()` で実行しているコマンドは全体的に参考になる
  - gitのサブコマンドとか知らなかったものが多い
- OSのチェック部分はベースラインにしてよいかも
- `if get(g:, "gh_open_command", "") == ""` でグローバル変数の存在チェック
- `<SID>` は `s:` と等価
- 一番気になっていた「HTTPSプロトコルでのリモートリポジトリのリンク取得部分」は、おおよそ自分が予想していたものと同じような泥臭いコードを書いていた
- `inputsave(), input(), inputrestore()` はユーザに入力を促す方法のベースラインと思っておく
- Vim scriptのテストの書き方とか実行方法を殆ど知らないので、テストスクリプトの書き方も参考になるかも知れない

https://github.com/tyru/capture.vim

一時バッファ（？）の使い方とかを知っておきたかった。

- プラグインの2重ロードを防ぐのは作法なんだなと思ったけど、記法の意味がよくわからなかった
  - https://vi.stackexchange.com/questions/15920/why-vim-plugins-have-a-check-on-cp
  - ということらしい
- バッファ書き込みの処理で呼ばれるようなVim script組み込み関数は押さえておきたい
  - `setline` とか、自分でちょっとしたプラグインを作るときもすぐ取り出せるようにしておきたい
- `setlocal buftype=nofile bufhidden=unload noswapfile nobuflisted` あたりでとりあえず使い捨てのバッファは生成できる？
- `= でVim scriptのインライン評価？みたいなことができるっぽい

## 2022-12-02

この日は飲み会だったのでおやすみ。

## 2022-12-03

https://github.com/junegunn/fzf

ちょっと大きいが、fzfが好きなので中でどういうことをしているか知っておきたい。

、、改めて思ったが、ドキュメントすらちゃんと読み切っていなかったので、まずはそこからスタートすることになってしまった。
エントリポイントから1つ下ったRun関数ぐらいはちょっと読んだけど、ほぼさっぱりだったため。

設定について調べ直していたら、せいぜいkey-bindingsのスクリプトを読む、ぐらいしかできなかった。

## 2022-12-04

https://github.com/glidenote/memolist.vim

日々とてもお世話になっているVimプラグイン。
全体のコードサイズも小さいのでとっつきやすそうと思ったので、読んでみる。

https://github.com/mattn/memo

その後はmattnさんのこちらも読みたい。

- `&undolevels` とかアンパサンドが頭につく記法が出てきたが、これはset対象のオプションの現在の設定値を取得している？
- `append` という関数がバッファに追記していく関数らしい
  - 名前が汎用的すぎて分かりづらい、、
- 「そういえば、memolistは初期のバッファは作成してくれるけど、明示的に保存処理をしないとファイルを作成してくれなかった」というのをコードを読みながら思い出した
  - 理由が知れてよかった
  - 初期のバッファを準備するにあたっては、設定値を上手く切り替えたりしているようだった

## 2022-12-05

https://github.com/junegunn/vim-plug

今日はvim-plugを読んで見る。
前々からVimのプラグインマネージャの中身は読まないといけない、とは思っていた。

というか、プラグインマネージャの概要を把握して、できれば別のカスタマイズしやすいものに乗り換えたい。
neovimの起動速度を上げたい。

- `expand(<sfile>)` とすると、source時にsfileの部分が読み込まれたファイル名で置き換えられる
- `stdpath()` という関数はneovim使う上で知っておいたほうが良さそう
  - `:echo stdpath('config')` とかすると、知りたかった情報がわかったりするかも
- rtpって何？ってずっと思ってたけどruntimepathのことらしい
  - 少しでも気になったらさっさとhelpを開こう
- 当たり前だけど、スター数3万ぐらいに支持されてるだけあって、UIとかOSとかの考慮が厚い
  - deinとかのコードを読むときは覚悟が必要そう
  - ぶっちゃけ、progressのペインとかはあまり今は興味がないので、ファイル分割されていたら嬉しかった

## 2022-12-06

https://github.com/rhysd/vim-startuptime

vim(neovim)の起動速度を測定してくれるGo製のツール。
vim起動速度を上げたいと思ってるので、モチベを得るためにも読んで見る。

- まず、標準パッケージしか使っていないのが、すごく安心する
- 自身のコードもmainパッケージのみ
- verboseフラグありのときは、メッセージを標準エラーに出力している
  - Goなので愚直に `if verbose ...` みたいに毎回書いているから関数化したほうがいいのでは？とか思ったけど、愚直な方がexplicitで読みやすくて良いのかも、とか思い始めた
- 読みやすいプログラムだけど、関数単位にコメントぐらいは欲しい気はしてくる？
  - 少なくとも邪魔になることはないような
- 一時的なディレクトリ・ファイルの作成、ファイルの読み込み、統計量の計算など、基本的なCLIツールを作る際の参考になりそう

## 2022-12-07

https://github.com/itchyny/mmv

これも時々お世話になるGo製のツール。
vimの感覚で複数ファイルをリネームできて使いやすい。

- Goファイルは2つだけでトータルの行数も400行程度しかない、けどこんなに便利なツールになっているし、スター数からもわかるように支持されている
- run関数はerrorではなく終了コードを返している
- `strings.Fields` は文字列を空白で区切ってくれるっぽい、地味に知らなかった
- mattnさんのgo-ttyも読まないといけない雰囲気
- globパターンの引数って、Goのflagパッケージが賢く処理してくれるんだろうか？
  - 全然わかってないが、少なくともmmv側でそういったことをしている雰囲気ではない
- コメントは、独自で提供するパッケージでは結構手厚く書かれていて、標準パッケージや外部パッケージをメインに使う部分はコメントが皆無、という感じになっている
- 一時ファイルからリネーム情報を構築するところが大変
  - テストケースを見るとわかるが、ファイル名を循環させたいケースなどの対応が必要
  - 当然他にも色々必要

